## 5장 : 책임 할당하기

### 도메인 개념에서 출발하기
- GRASP pattern : General Responsibility Assignment Software Pattern
- 올바른 도메인 모델은 존재하지 않는다. 실용적이고 유용한 모델이 답이다.
1. 정보 전문가에개 책임을 할당한다. 하지만 정보 전문가가 반드시 데이터를 저장하고 있을 필요는 없다!
2. 높은 응집도와 낮은 결합도에 유의하자.
3. 창조자에게 객체 생성 책임을 할당하자. 아래 조건을 최대한 많이 만족하는 B에게 A의 생성 할당 책임을 주자.
    - B가 A객체를 포함하고나 참조한다.
    - B가 A객체를 기록한다.
    - B가 A객체를 긴말하게 사용한다.
    - B가 A를 초기화하는 데 필요한 데이터를 가지고 있다.
    - 영화 예매 협력의 최종 결과물은 Reservation 인스턴스이다. 따라서 Screening이 창조자에 적합하다.
    

### DiscountCondition 개선하기
- 변경에 취약한 클래스란, 코드를 수정해야 할 이유를 하나 이상 가지는 클래스이다.
- 새로운 할인 조건이 추가될 경우, 순번 조건을 판단하는 로직을 변경할 경우, 기간 조건을 판단하는 로직을 변경할 경우 변경될 수 있다.
- 이와 같이 변경 이유가 많다면, 응집도가 낮은 것이다. 이는 서로 관련성이 없는 기능이나 데이터가 하나의 클래스에 뭉쳐있음을 의미한다.
- 따라서 변경의 이유에 따라 클래스를 분리해야 한다.
    1. 인스턴스 변수가 초기화 되는 시점을 살피자. 이 때 일부 변수가 초기화 되지 않을 경우, 함께 초기화 되는 속성으로 분리하자.
    2. 메서드들이 인스턴스 변수를 사용하는 방식을 살피자. 속성에 따라 메서드가 나뉜다면, 응집도가 낮은것이다.
    

### 다형성 패턴
- 객체의 타입에 따라 변하는 행동이 있다면 타입을 분리하고 변화하는 행동을 각 타입의 책임으로 할당한다. 
- 조건에 따른 논리가 존재할 경우, 수정하기가 매우 어렵고 변경에 취약해진다. 대신 다형성을 이용한다.

### 변경으로부터 보호 - Protected variations 패턴
- 변화가 예상되는 불안정한 지점을 식별하고, 그 주위에 안정된 인터페이스를 형성하도록 책임을 할당한다.
- 즉, 변경될 가능성이 높으면 캡슐화를 진행한다.


### 리팩터링
- 응집도가 낮은 메서드는 로직의 흐름을 이해하기 위해 주석이 필요한 경우가 많다.
- 대신 메서드를 작게 분해해서 각 메서드의 응집도를 높이자.
- 응집도 높은 메서드는 변경되는 이유가 단 하나여야 한다. 이를 통해 변경 처리를 위해 어떤 메서드를 수정해야하는지를 쉽게 알 수 있다.
- 또한 작은 메서드들로 조합된 메서드는, 마치 주석을 나열한 것처럼 보이기 때문에 코드 이해도 쉽다.
- chap4(데이터 중심 설계)를 chap5.step5로 리펙토링 + 테스트를 진행했다. 책임 주도 설계에 익숙하지 않다면, 일단 데이터 중심으로 설계하고 리팩터링 하더라도 유사한 결과를 얻을 수 있다.
- 캡슐화, 결합도, 응집도를 이해하고 훌륭한 객체지향 원칙을 지키기 위해 노력한다면, 책임 주도 설계를 단계적으로 따르지 않아도 유연하고 깔끔한 코드를 리팩터링을 통해 얻을 수 있다.