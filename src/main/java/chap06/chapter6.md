## 6장 : 메시지와 인터페이스

### 협력과 메시지
- 객체는 협력에 참여하는 동안 클라이언트(메시지를 보냄), 서버(메시지를 받고 처리)의 역할을 동시에 한다.
- 용어 정리
    - 메시지 
        - 객체들이 협력하기 위해 사용할 수 있는 유일한 의사소통 수단
        - 오퍼레이션명, 인자로 구성되며 메시지 전송은 여기에 메시지 수신자를 추가하는 것이다.
        <br><br>
    - 메서드
        - 메시지를 수신했을 때 실제로 어떤 코드가 실행되는지는 메시지 수신자의 실제 타입에 달려있다.
        - 이처럼 실제로 실행되는 함수 또는 프로시저를 메서드라고 한다.
      <br><br>
    - 퍼블릭 인터페이스
        - 객체가 의사소통을 위해 외부에 공개하는 메시지 집합
      <br><br>
    - 오퍼레이션
        - 퍼블릭 인터페이스에 포함된 (추상화된) 메시지
      <br><br>
    - 시그니쳐
        - 오퍼레이션(또는 메서드)의 이름과 파라미터 목록을 말한다. 명세라고 생각하면 쉽다.
        - 메서드는 시그니쳐에 구현을 더한 것이다.
        

### 인터페이스와 설계 품질
- 좋은 인터페이스는 최소한의 인터페이스와 추상적인 인터페이스라는 조건을 만족해야 한다.
- 여기에 영향을 미치는 디미터 법칙, 묻지 말고 시켜라, 의도를 드러내는 인터페이스, 명령-쿼리 분리에 대해 알아보자.

#### 디미터 법칙
- "낯선 자에게 말하지 말라", "오직 인접한 이웃하고만 말하라", "오직 하나의 도트만 사용해라"로 정의할 수 있다.
- 클래스가 특정 조건을 만족하는 대상에게만 메시지를 전송하도록 해야 한다.
   - this 객체, 메서드의 매개변수, this의 속성, this의 속성인 컬렉션의 요소, 메서드 내에서 생성된 지역 객체
    
- 이는 캡슐화를 다른 관점에서 표현한 것이다. 캡슐화 원칙이 내부의 구현을 감추어야 한다는 사실을 강조한다면, 디미터 법칙은 
협력하는 클래스의 캡슐화를 지키기 위해 접근해야 하는 요소를 제한한다.
  
- 디미터 법칙은 객체가 자기 자신을 책임지는 자율적인 존재여야 한다는 사실을 강조한다. 정보를 처리하는 데 필요한 책임을, 정보를 알고 있는
객체에게 할당하기 때문에 응집도가 높은 객체가 만들어진다.
  
- 하지만 무비판적인 디미터 법칙은 퍼블릭 인터페이스 관점에서 객체의 응집도가 낮아질 수 있다.

#### 묻지 말고 시켜라
- 메시지 전송자는 메시지 수신자의 상태를 기반으로 결정을 내린 후에 메시지 수신자의 상태를 변경해서는 안된다. 이는 객체의 캡슐화를 위반한다.
- 상태를 묻는 오퍼레이션을 행동을 요청하는 오퍼레이션으로 대체함으로써 인터페이스를 향상시키자.


#### 의도를 드러내는 인터페이스
- 메서드의 이름은 어떻게가 아니라 무엇을 하는지를 드러내는 것이다. 
- 어떻게 수행해야하는지를 적용한 메서드는 내부를 설명하는 이름이다. 따라서 이른 시기부터 클래스의 내부 구현을 고민하게 된다.
- 객체에게 묻지 말고 시키되, 구현 방법이 아닌 클라이언트의 의도를 드러내야 한다.
- 오퍼레이션의 이름은 협력이라는 문맥을 반영해야 한다. 


#### 원칙의 함정
- 디미터 법칙과 묻지 말고 시켜라 스타일은 원칙일 뿐 절대적인 법칙은 아니다. 따라서 예외가 넘쳐난다.
- 디미터 법칙은 하나의 도트를 강제하는 규칙이 아니다. stream의 경우 도트를 많이 사용하지만, 이는 동일한 클래스에 대한 메서드로, 객체의 내부에 대한 어떤 내용도 묻지 않으므로 
디미터의 법칙을 어겼다고 할 수 없다.
- 물으려는 객체가 정말로 데이터일 경우에는 당연히 내부를 노출해서 정보를 알려줘야 하므로, 디미터 법칙을 지킬 필요 없다.

#### 명령-쿼리 분리 원칙
- 루틴 : 어떤 절차를 묶어 호출 가능하도록 부여한 기능 모듈
   - 프로시져 : 부수효과를 발생시키지만(상태 변경) 값을 반환할 수 없다 = 명령
   - 함수 : 값을 반환하지만 부수효과를(상태 변경 x) 발생시키지 않는다 = 쿼리
- 오퍼레이션은 위의 둘 중 하나의 기능만 담당해야 한다.
- 명령과 쿼리를 뒤섞으면 실행 결과를 예측하기 어려워진다. 
- 쿼리는 반환값만을 돌려주므로 부수효과(상태 변경)에 대한 부담이 없다. 따라서 여러번 호출하더라도 다른 부분에 영향을 미치지 않는다.
- 명령과 쿼리를 분리하게 되면, 인터페이스를 훑는것 만으로 어떤 역할을 하는 지 알 수 있다.

#### 명령-쿼리 분리와 참조 투명성
- 수학의 함수는 참조 투명성의 좋은 예이다. 어떤 함수 A가 있을 때 함수의 값(10)으로 교체하더라도 결과가 달라지지 않는다.
- 명령-쿼리 분리 원칙을 통해 쿼리(참조 투명성)를 사용하여 참조 투명성을 경험할 수 있다.


### 정리 - 책임에 초점을 맞춰라
- 디미터 법칙 : 협력이라는 컨텍스트 안에서 객체보다 메시지를 먼저 결정하면 두 객체 사이의 구조적인 결합도를 낮출 수 있다.
수신할 객체를 알지 못한 상태에서 메시지를 먼저 선택했기 때문에 객체 내부 구조에 대해 고민할 필요가 없어진다. 따라서 메시지가 객체를
  선택하게 함으로써 의도적으로 디미터 법칙을 위반할 위험을 최소화할 수 있다.
  

- 묻지 말고 시켜라 : 메시지를 먼저 선택하면 묻지 말고 시켜라 스타일에 따라 협력을 구조화하게 된다. 클라이언트의 관점에서 메시지를 선택하기 때문에
필요한 정보를 물을 필요 없이 원하는 것을 표현한 메시지를 전송하면 된다.
  

- 의도를 드러내는 인터페이스 : 메시지를 먼저 선택했다는 것은 클라이언트 관점에서 이름을 정한다는 것이다. 당연히 그 이름에는 클라이언트가 무엇을 원하는 지 의도가 분명히
드러날 수밖에 없다.
  
  
- 명령-쿼리 분리 원칙 : 메시지를 먼저 선택했다는 것은 협력이라는 문맥 안에서 객체의 인터페이스에 관해 고민한다는 것을 의미한다.
객체가 단순히 어떤 일을 해야하는지 뿐 아니라 협력 속에서 객체의 상태를 예측하고 이해하기 쉽게 만들기 위한 방법에 관해 고민하게 된다.
  따라서 예측 가능한 협력을 만들기 위해 명령과 쿼리를 분리하게 될 것이다.